{% extends 'layout.html' %}

{% block body %}
<div class="container">
	<h1> Photo </h1>
	{% include "photo.html" %}
	
    {% for photo in photo.get_similar %}
    	<img src="{{photo.path.url}}" style="height: 100px;" />
    {% endfor %}
	{{photo.likes.count}} likes <br />

	<div>
		{% if request.user.is_authenticated and user != photo.user%}
		    {% if request.user in photo.likes.all %}
		        <button class="btn btn-primary" onclick="like()">
		            <i class="material-icons md-14">favorite_border</i> 
		            Unlike
		        </button>
		    {% else %}
		        <button class="btn btn-primary" onclick="like()">
		            <i class="material-icons md-14">favorite</i> 
		            Like
		        </button>
		    {% endif %}
		{% endif %}
	</div>

    {% if request.user.is_authenticated and user == photo.user %}
		<a href="{% url 'delete_photo' pk=photo.pk %}">
			<button class="btn btn-danger">
				<i class="material-icons md-14">delete_forever</i> 
				Delete post
			</button>
		</a>
	{% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
	let like = function() {
	    let xhttp = new XMLHttpRequest();
	    xhttp.onreadystatechange = function() {
	        if (this.readyState == 4 && this.status == 200) {
	            window.location.reload();
	        }
	    };
	    xhttp.open('GET', 
	    			'{% url "like_photo" photo_pk=photo.pk %}', 
	    			true);
	    xhttp.send();
	}
</script>
{% endblock %}